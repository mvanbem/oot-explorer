<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `deref_map` crate."><meta name="keywords" content="rust, rustlang, rust-lang, deref_map"><title>deref_map - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script src="../storage.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg">
<link rel="alternate icon" type="image/png" href="../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../deref_map/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><p class='location'>Crate deref_map</p><div class='block version'><p>Version 0.1.0</p></div><div class="sidebar-elems"><a id='all-types' href='all.html'><p>See all deref_map's items</p></a><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#traits">Traits</a></li></ul></div><p class='location'></p><script>window.sidebarCurrent = {name: 'deref_map', ty: 'mod', relpath: '../'};</script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><span class="help-button">?</span>
                <a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../src/deref_map/lib.rs.html#1-83' title='goto source code'>[src]</a></span><span class='in-band'>Crate <a class="mod" href=''>deref_map</a></span></h1><div class='docblock'><p>Extension traits for mapping <a href="https://doc.rust-lang.org/nightly/core/ops/deref/trait.Deref.html"><code>Deref</code></a> and <a href="https://doc.rust-lang.org/nightly/core/ops/deref/trait.DerefMut.html"><code>DerefMut</code></a>
values.</p>
<p>To concisely borrow a value from a container with interior mutability, this crate provides
extension traits to adapt a <code>Deref</code> value to a new one with a different target type, and the
same for <code>DerefMut</code>.</p>
<h1 id="example" class="section-header"><a href="#example">Example</a></h1>
<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">deref_map</span>::{<span class="ident">DerefMapExt</span>, <span class="ident">DerefMutMapExt</span>};

<span class="kw">struct</span> <span class="ident">Foo</span> {
    <span class="ident">bar</span>: <span class="ident">u32</span>,
}

<span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">borrow_bar_from_foo</span>(<span class="ident">foo</span>: <span class="kw-2">&amp;</span><span class="ident">Mutex</span><span class="op">&lt;</span><span class="ident">Foo</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="kw">impl</span> <span class="ident">Deref</span><span class="op">&lt;</span><span class="ident">Target</span> <span class="op">=</span> <span class="ident">u32</span><span class="op">&gt;</span> <span class="op">+</span> <span class="lifetime">&#39;_</span> {
    <span class="ident">foo</span>.<span class="ident">lock</span>().<span class="ident">unwrap</span>().<span class="ident">map_ref</span>(<span class="op">|</span><span class="ident">foo</span><span class="op">|</span> <span class="kw-2">&amp;</span><span class="ident">foo</span>.<span class="ident">bar</span>)
}

<span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">borrow_bar_from_foo_mut</span>(<span class="ident">foo</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">Mutex</span><span class="op">&lt;</span><span class="ident">Foo</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="kw">impl</span> <span class="ident">DerefMut</span><span class="op">&lt;</span><span class="ident">Target</span> <span class="op">=</span> <span class="ident">u32</span><span class="op">&gt;</span> <span class="op">+</span> <span class="lifetime">&#39;_</span> {
    <span class="ident">foo</span>.<span class="ident">lock</span>().<span class="ident">unwrap</span>().<span class="ident">map_mut</span>(<span class="op">|</span><span class="ident">foo_ref</span><span class="op">|</span> <span class="kw-2">&amp;</span><span class="ident">foo_ref</span>.<span class="ident">bar</span>, <span class="op">|</span><span class="ident">foo_mut</span><span class="op">|</span> <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">foo_mut</span>.<span class="ident">bar</span>)
}</pre></div>
<p>The <a href="../deref_map/trait.DerefMapExt.html#method.map_ref"><code>map_ref</code></a> method takes a closure <code>Fn(&amp;T) -&gt; &amp;R</code> and wraps a
<code>Deref&lt;Target = T&gt;</code> into a <code>Deref&lt;Target = R&gt;</code>.</p>
<p>The <code>DerefMut</code> trait requires the <code>Deref</code> trait, so <a href="../deref_map/trait.DerefMutMapExt.html#method.map_mut"><code>map_mut</code></a>
takes two closures, one <code>Fn(&amp;T) -&gt; &amp;R</code> for <code>Deref</code>, and one <code>FnMut(&amp;mut T) -&gt; &amp;mut R</code> for
<code>DerefMut</code>.</p>
<p>Note the <code>T + '_</code> lifetime specifier on both return types. That tells the compiler that the
container must remain borrowed while the returned value is live, and in turn permits the
returned value to capture the borrowed container.</p>
<h1 id="motivation" class="section-header"><a href="#motivation">Motivation</a></h1>
<p>It's easy to borrow values from smart pointers like <a href="https://doc.rust-lang.org/nightly/alloc/boxed/struct.Box.html" title="Box"><code>Box</code></a>, <a href="https://doc.rust-lang.org/nightly/alloc/rc/struct.Rc.html"><code>Rc</code></a>, and
<a href="https://doc.rust-lang.org/nightly/alloc/sync/struct.Arc.html"><code>Arc</code></a> that implement <code>Deref</code>.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">fn</span> <span class="ident">borrow_bar_from_foo</span>(<span class="ident">foo</span>: <span class="kw-2">&amp;</span><span class="ident">Box</span><span class="op">&lt;</span><span class="ident">Foo</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="kw-2">&amp;</span><span class="ident">u32</span> {
    <span class="kw-2">&amp;</span><span class="ident">foo</span>.<span class="ident">bar</span>
}</pre></div>
<p>But containers with interior mutability like <a href="https://doc.rust-lang.org/nightly/core/cell/struct.RefCell.html"><code>RefCell</code></a>,
<a href="https://doc.rust-lang.org/nightly/std/sync/mutex/struct.Mutex.html"><code>Mutex</code></a>, and <a href="https://doc.rust-lang.org/nightly/std/sync/rwlock/struct.RwLock.html"><code>RwLock</code></a> cannot implement <code>Deref</code>. They
have accessors that need to be able to fail in order to enforce the borrowing rules, and they
need to be informed when the borrow ends. Instead, their accessors return a wrapper that
implements <code>Deref</code> (and usually <a href="https://doc.rust-lang.org/nightly/core/ops/drop/trait.Drop.html" title="Drop"><code>Drop</code></a> as well).</p>
<p>Simply borrowing from the wrapper leaves no way for the wrapper to live as long as the borrow.</p>

<div class='information'><div class='tooltip compile_fail'>ⓘ<span class='tooltiptext'>This example deliberately fails to compile</span></div></div><div class="example-wrap"><pre class="rust rust-example-rendered compile_fail">
<span class="kw">fn</span> <span class="ident">borrow_bar_from_foo</span>(<span class="ident">foo</span>: <span class="kw-2">&amp;</span><span class="ident">RefCell</span><span class="op">&lt;</span><span class="ident">Foo</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="kw-2">&amp;</span><span class="ident">u32</span> {
    <span class="kw">let</span> <span class="ident">wrapper</span> <span class="op">=</span> <span class="ident">foo</span>.<span class="ident">borrow</span>();
    <span class="kw-2">&amp;</span><span class="ident">wrapper</span>.<span class="ident">bar</span>
    <span class="comment">// wrapper is dropped here, so our borrow is invalid</span>
}</pre></div>
</div><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table><tr class='module-item'><td><a class="struct" href="struct.MapMut.html" title='deref_map::MapMut struct'>MapMut</a></td><td class='docblock-short'><p>An adapter from <a href="https://doc.rust-lang.org/nightly/core/ops/deref/trait.DerefMut.html" title="DerefMut"><code>DerefMut</code></a><code>&lt;Target = T&gt;</code> to <code>DerefMut&lt;Target = R&gt;</code>.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.MapRef.html" title='deref_map::MapRef struct'>MapRef</a></td><td class='docblock-short'><p>An adapter from <a href="https://doc.rust-lang.org/nightly/core/ops/deref/trait.Deref.html" title="Deref"><code>Deref</code></a><code>&lt;Target = T&gt;</code> to <code>Deref&lt;Target = R&gt;</code>.</p>
</td></tr></table><h2 id='traits' class='section-header'><a href="#traits">Traits</a></h2>
<table><tr class='module-item'><td><a class="trait" href="trait.DerefMapExt.html" title='deref_map::DerefMapExt trait'>DerefMapExt</a></td><td class='docblock-short'><p>An extension trait for <a href="https://doc.rust-lang.org/nightly/core/ops/deref/trait.Deref.html" title="Deref"><code>Deref</code></a> for transforming the dereferenced value.</p>
</td></tr><tr class='module-item'><td><a class="trait" href="trait.DerefMutMapExt.html" title='deref_map::DerefMutMapExt trait'>DerefMutMapExt</a></td><td class='docblock-short'><p>An extension trait for <a href="https://doc.rust-lang.org/nightly/core/ops/deref/trait.DerefMut.html" title="DerefMut"><code>DerefMut</code></a> for transforming the dereferenced value.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../";window.currentCrate = "deref_map";</script><script src="../main.js"></script><script defer src="../search-index.js"></script></body></html>